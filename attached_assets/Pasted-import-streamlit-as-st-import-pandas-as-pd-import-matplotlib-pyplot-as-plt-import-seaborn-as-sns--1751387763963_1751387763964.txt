import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Config Streamlit
st.set_page_config(layout="wide")
st.title("ğŸ“Š Fiche Joueur - Saison 2024/25")

# â¬†ï¸ Upload du fichier CSV
uploaded_file = st.file_uploader("Charge ton fichier CSV de joueurs", type=["csv"])

if uploaded_file:
    df = pd.read_csv(uploaded_file)

    # â• SÃ©lection joueur
    joueur = st.selectbox("Choisis un joueur", sorted(df["Player"].unique()))
    data = df[df["Player"] == joueur].squeeze()

    st.header(f"ğŸ§‘â€ğŸ’¼ {joueur} - {data['Team']} ({data['Position']})")

    st.markdown(f"""
    **Ã‚ge** : {data['Age']} ans  
    **Taille** : {data.get('Height', 'â€”')}  
    **Pied fort** : {data.get('Foot', 'â€”')}  
    **Note moyenne** : {data.get('Rating', 'â€”')}  
    """)

    # ğŸ¯ Statistiques par 90 minutes
    st.subheader("ğŸ“ˆ Statistiques avancÃ©es (par 90 min) + Percentiles")

    cols_metrics = [
        ("Buts", "Goals_per90", "Percentile_Goals"),
        ("Passes dÃ©c.", "Assists_per90", "Percentile_Assists"),
        ("Dribbles rÃ©ussis", "Dribbles_per90", "Percentile_Dribbles"),
        ("Centres", "Crosses_per90", "Percentile_Crosses"),
        ("Passes progressives", "Progressive_passes_per90", "Percentile_Progressive_Passes"),
        ("Tacles", "Tackles_per90", "Percentile_Tackles"),
        ("Interceptions", "Interceptions_per90", "Percentile_Interceptions"),
        ("Limite de dÃ©chet", "Passes_completed_pct", "Percentile_Pass_Completion"),
    ]

    for label, col_val, col_pct in cols_metrics:
        val = round(data[col_val], 2) if col_val in data else None
        pct = int(data[col_pct]) if col_pct in data else None
        if val is not None and pct is not None:
            color = "ğŸŸ¥" if pct < 40 else "ğŸŸ¨" if pct < 70 else "ğŸŸ©"
            st.write(f"**{label}** : {val} / 90 min â€” {color} {pct}áµ‰ percentile")
            st.progress(pct / 100)

    # ğŸ§  Analyse automatique
    st.markdown("---")
    st.subheader("ğŸ§  RÃ©sumÃ© analytique")
    if data["Percentile_Dribbles"] > 80 and data["Percentile_Assists"] > 80:
        st.success("Joueur crÃ©atif, fort en 1v1, excellent dans la derniÃ¨re passe.")
    elif data["Percentile_Tackles"] > 70:
        st.success("Joueur trÃ¨s actif Ã  la rÃ©cupÃ©ration.")
    else:
        st.info("Profil Ã©quilibrÃ©. Potentiel Ã  dÃ©velopper dans un systÃ¨me adaptÃ©.")

    st.markdown("---")
    st.caption("GÃ©nÃ©rÃ© automatiquement Ã  partir des donnÃ©es CSV 2024/25 â€” Projet de Khalil ğŸ§¬")
